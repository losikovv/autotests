plugins {
    id 'java'
    id 'com.google.protobuf' version '0.8.17'
}

apply from: 'dependencies.gradle'
apply from: 'task.gradle'

subprojects {
    apply plugin: 'java'
    apply plugin: 'idea'

    apply from: project(":").getRootDir().path+"/variables.gradle"

    repositories {
        mavenCentral()
        mavenLocal()
    }

    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11

    [compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

    sourceSets {
        main {
            java {
                srcDirs = ['src/main/java']
            }
            resources {
                srcDirs = ['src/main/resources']
            }
        }
    }
}

project(":reforged") {
    apply plugin: "java-library"

    dependencies {
        implementation project(":kraken")
        implementation project(":api")
        implementation project(":qase-api")
        implementation project(":utils")

        implementation lib.jackson
        implementation lib.aspectjweaver
        implementation lib.seleniumJava
        implementation lib.allureTestng
        implementation lib.allureJavaCommons
        implementation lib.testng
        implementation lib.jsonSimple
        implementation lib.webdrivermanager

        compileOnly lib.lombok

        annotationProcessor lib.lombok
        testImplementation lib.logback
        testCompileOnly lib.lombok
        testAnnotationProcessor lib.lombok
    }
}

project(":kraken") {
    apply plugin: "java-library"

    dependencies {
        implementation project(":qase-api")
        implementation project(":ab")
        implementation project(":qa-api")
        implementation project(":utils")

        implementation lib.testng
        implementation lib.jsonSimple
        implementation lib.jackson
        implementation lib.allureTestng
        implementation lib.allureJavaCommons
        implementation lib.pgsqlJDBC

        compileOnly lib.lombok
        annotationProcessor lib.lombok
        testImplementation lib.logback
        testCompileOnly lib.lombok
        testAnnotationProcessor lib.lombok
    }
}

project(":ui") {
    apply plugin: "java-library"

    dependencies {
        implementation project(":kraken")
        implementation project(":api")
        implementation project(":qase-api")
        implementation project(":utils")

        implementation lib.aspectjweaver
        implementation lib.seleniumJava
        implementation lib.allureTestng
        implementation lib.allureJavaCommons
        implementation lib.jsonSimple
        implementation lib.testng

        compileOnly lib.lombok
        annotationProcessor lib.lombok
        testImplementation lib.logback
        testCompileOnly lib.lombok
        testAnnotationProcessor lib.lombok
    }
}

project(":api") {
    apply plugin: "java-library"
    apply plugin: 'com.google.protobuf'

    protobuf {
        generatedFilesBaseDir = "$projectDir/src/generated"
        protoc {
            artifact = lib.protobufProtoc
        }
        plugins {
            grpc {
                artifact = lib.protocGenGrpcJava
            }
        }
        generateProtoTasks {
            all()*.plugins {
                grpc {}
            }
        }
    }

    dependencies {
        implementation project(":kraken")
        implementation project(":qase-api")
        implementation project(":utils")

        implementation lib.restAssured
        implementation lib.aspectjweaver
        implementation lib.allureRestAssuredReport
        implementation lib.allureTestng
        implementation lib.allureJavaCommons
        implementation lib.jsonSimple
        implementation lib.testng
        implementation lib.restAssuredSchemaValidator

        implementation lib.pgsqlJDBC
        implementation lib.mysqlJDBC
        implementation lib.kubernetesClient

        implementation lib.kafkaClients

        implementation lib.grpcNettyShaded
        implementation lib.grpcProtobuf
        implementation lib.grpcStub
        implementation lib.tomcatAnnotationsApi

        compileOnly lib.lombok

        annotationProcessor lib.lombok
        testImplementation lib.logback
        testCompileOnly lib.lombok
        testAnnotationProcessor lib.lombok
    }
}

project(":qase-api") {
    apply plugin: "java-library"

    dependencies {
        implementation lib.allureJavaCommons
        implementation lib.lombok
        implementation lib.jsonSimple
        implementation lib.konghq
        testImplementation lib.logback
        annotationProcessor lib.lombok
    }
}

project(":ab") {
    apply plugin: "java-library"

    dependencies {
        implementation project(":utils")

        implementation lib.lombok
        implementation lib.okhttp
        implementation lib.jacksonAnnotations
        implementation lib.jackson
        implementation lib.logback

        annotationProcessor lib.lombok
    }
}

project(":qa-api") {
    apply plugin: "java-library"

    dependencies {
        implementation project(":utils")

        implementation lib.lombok
        implementation lib.okhttp
        implementation lib.jacksonAnnotations
        implementation lib.jackson
        implementation lib.logback

        annotationProcessor lib.lombok
    }
}

project(":utils") {
    apply plugin: "java-library"

    dependencies {
        implementation lib.lombok
        implementation lib.jacksonAnnotations
        implementation lib.jackson
        implementation lib.logback
        implementation lib.commonLang

        annotationProcessor lib.lombok
    }
}
